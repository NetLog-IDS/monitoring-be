<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flow Details | Network IDS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -9px;
            top: 0;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background-color: #0ea5e9;
            border: 3px solid white;
            z-index: 1;
        }
        
        .timeline-item::after {
            content: '';
            position: absolute;
            left: 0;
            top: 18px;
            bottom: 0;
            width: 1px;
            background-color: #e5e7eb;
        }
        
        .timeline-item:last-child::after {
            display: none;
        }
        
        .dark .timeline-item::before {
            border-color: #1f2937;
        }
        
        .dark .timeline-item::after {
            background-color: #374151;
        }
        
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .hexdump {
            font-family: monospace;
            font-size: 0.875rem;
            line-height: 1.25rem;
        }
        
        .hexdump .offset {
            color: #6b7280;
        }
        
        .hexdump .hex {
            color: #1f2937;
        }
        
        .hexdump .ascii {
            color: #4b5563;
        }
        
        .dark .hexdump .hex {
            color: #e5e7eb;
        }
        
        .dark .hexdump .ascii {
            color: #9ca3af;
        }
        
        @keyframes pulse-highlight {
            0%, 100% { background-color: rgba(14, 165, 233, 0.1); }
            50% { background-color: rgba(14, 165, 233, 0.2); }
        }
        
        .pulse-highlight {
            animation: pulse-highlight 2s ease-in-out infinite;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-200">
    <!-- Top Navigation Bar -->
    <nav class="bg-white dark:bg-gray-800 shadow-md px-6 py-4 flex justify-between items-center sticky top-0 z-10">
        <div class="flex items-center space-x-3">
            <i class="fas fa-shield-alt text-primary-600 dark:text-primary-400 text-2xl"></i>
            <h1 class="text-xl font-bold text-gray-800 dark:text-white">Network IDS</h1>
        </div>
        <div class="flex items-center space-x-4">
            <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
                <i class="fas fa-moon dark:hidden text-gray-600"></i>
                <i class="fas fa-sun hidden dark:block text-yellow-300"></i>
            </button>
        </div>
    </nav>

    <!-- Breadcrumb Navigation -->
    <div class="container mx-auto px-4 py-4">
        <div class="flex items-center text-sm text-gray-600 dark:text-gray-400">
            <a href="/" class="hover:text-primary-600 dark:hover:text-primary-400">
                <i class="fas fa-home mr-1"></i>
                Dashboard
            </a>
            <i class="fas fa-chevron-right mx-2 text-gray-400 dark:text-gray-600"></i>
            <span class="text-gray-800 dark:text-gray-200 font-medium">Flow Details</span>
            <span class="ml-2 text-gray-500 dark:text-gray-500">({{ flow.fid }})</span>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mx-auto px-4 pb-12">
        <!-- Flow Status Banner -->
        <div class="mb-6 rounded-lg overflow-hidden shadow-md">
            <div class="{% if prediction != 'Benign' %}bg-red-600 dark:bg-red-800{% else %}bg-green-600 dark:bg-green-800{% endif %} px-6 py-4 flex justify-between items-center">
                <div class="flex items-center">
                    <div class="bg-white dark:bg-gray-800 rounded-full p-2 mr-4">
                        <i class="{% if prediction != 'Benign' %}fas fa-exclamation-triangle text-red-600 dark:text-red-500{% else %}fas fa-check-circle text-green-600 dark:text-green-500{% endif %}"></i>
                    </div>
                    <div>
                        <h2 class="text-white font-bold text-lg">{{ prediction }}</h2>
                        <p class="text-white text-opacity-90 text-sm">
                            {% if prediction != 'Benign' %}
                                Potential threat detected in this network flow
                            {% else %}
                                This network flow appears to be normal traffic
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Flow Details and Visualization -->
        <div class="gap-6 mb-6">
            <!-- Flow Details Card -->
            <div class="lg:col-span-2 bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
                    <h2 class="text-lg font-bold text-gray-800 dark:text-white flex items-center">
                        <i class="fas fa-info-circle mr-2 text-primary-500 dark:text-primary-400"></i>
                        Flow Information
                    </h2>
                </div>
                <div class="p-6">
                    <div class="w-full overflow-hidden border border-gray-200 dark:border-gray-700 rounded-lg">
                        <table class="w-full table-auto border-collapse">
                            <tbody>
                                <tr class="border-b border-gray-200 dark:border-gray-700">
                                    <td class="p-3 text-sm font-medium bg-gray-50 dark:bg-gray-700/50 w-1/3">Flow ID</td>
                                    <td class="p-3 text-sm">{{ flow.fid }}</td>
                                </tr>
                                <tr class="border-b border-gray-200 dark:border-gray-700">
                                    <td class="p-3 text-sm font-medium bg-gray-50 dark:bg-gray-700/50">Timestamp</td>
                                    <td class="p-3 text-sm">{{ flow.timestamp }}</td>
                                </tr>
                                <tr class="border-b border-gray-200 dark:border-gray-700">
                                    <td class="p-3 text-sm font-medium bg-gray-50 dark:bg-gray-700/50">Duration</td>
                                    <td class="p-3 text-sm">{{ flow.duration / 1000000 }} seconds</td>
                                </tr>
                                <tr class="border-b border-gray-200 dark:border-gray-700">
                                    <td class="p-3 text-sm font-medium bg-gray-50 dark:bg-gray-700/50">Source IP</td>
                                    <td class="p-3 text-sm flex items-center">
                                        {{ flow.srcIp }}
                                    </td>
                                </tr>
                                <tr class="border-b border-gray-200 dark:border-gray-700">
                                    <td class="p-3 text-sm font-medium bg-gray-50 dark:bg-gray-700/50">Source Port</td>
                                    <td class="p-3 text-sm">
                                        {{ flow.srcPort }}
                                    </td>
                                </tr>
                                <tr class="border-b border-gray-200 dark:border-gray-700">
                                    <td class="p-3 text-sm font-medium bg-gray-50 dark:bg-gray-700/50">Destination IP</td>
                                    <td class="p-3 text-sm flex items-center">
                                        {{ flow.dstIp }}
                                    </td>
                                </tr>
                                <tr class="border-b border-gray-200 dark:border-gray-700">
                                    <td class="p-3 text-sm font-medium bg-gray-50 dark:bg-gray-700/50">Destination Port</td>
                                    <td class="p-3 text-sm">
                                        {{ flow.dstPort }}
                                    </td>
                                </tr>
                                <tr>
                                    <td class="p-3 text-sm font-medium bg-gray-50 dark:bg-gray-700/50">Protocol</td>
                                    <td class="p-3 text-sm">
                                        {% if flow.dstPort == 80 or flow.dstPort == 443 %}
                                            TCP
                                        {% elif flow.dstPort == 53 %}
                                            UDP
                                        {% else %}
                                            TCP/IP
                                        {% endif %}
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="mt-6">
                        <h3 class="text-md font-semibold text-gray-800 dark:text-white mb-2">Flow Data</h3>
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 overflow-x-auto">
                            <pre class="text-sm text-gray-800 dark:text-gray-200">{{ flow.data }}</pre>
                        </div>
                    </div>
                </div>
            </div>
            
            
        </div>

        <!-- Packets Section -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <h2 class="text-lg font-bold text-gray-800 dark:text-white flex items-center">
                    <i class="fas fa-exchange-alt mr-2 text-primary-500 dark:text-primary-400"></i>
                    Associated Packets
                </h2>
                <div class="flex space-x-2">
                    <div class="relative">
                        <input type="text" id="packet-search" placeholder="Search packets..." 
                            class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-primary-500 w-64">
                        <i class="fas fa-search absolute right-3 top-3 text-gray-400"></i>
                    </div>
                    <div class="relative">
                        <select id="packet-filter" class="appearance-none bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 py-2 px-4 pr-8 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500">
                            <option value="all">All Packets</option>
                            <option value="tcp">TCP Only</option>
                            <option value="udp">UDP Only</option>
                            <option value="http">HTTP Only</option>
                            <option value="dns">DNS Only</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700 dark:text-gray-300">
                            <i class="fas fa-chevron-down"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Packets Table -->
            <div class="overflow-x-auto">
                <table class="w-full table-auto">
                    <thead class="bg-gray-50 dark:bg-gray-700">
                        <tr>
                            <th class="p-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">UID</th>
                            <th class="p-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Timestamp</th>
                            <th class="p-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Source</th>
                            <th class="p-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Destination</th>
                            <th class="p-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Protocol</th>
                            <th class="p-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Size</th>
                            <th class="p-4 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700" id="packets-table-body">
                        {% for packet in packets %}
                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-150" data-packet-id="{{ packet.uid }}">
                            <td class="p-4 text-sm text-gray-900 dark:text-gray-200">{{ packet.uid }}</td>
                            <td class="p-4 text-sm text-gray-500 dark:text-gray-400">{{ packet.timestamp }}</td>
                            <td class="p-4 text-sm text-gray-500 dark:text-gray-400">{{ packet.srcIp }}:{{ packet.srcPort }}</td>
                            <td class="p-4 text-sm text-gray-500 dark:text-gray-400">{{ packet.dstIp }}:{{ packet.dstPort }}</td>
                            <td class="p-4 text-sm">
                                <span class="px-2 py-1 text-xs font-semibold rounded-full 
                                    {% if 'TCP' in packet.layers %}
                                        bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300
                                    {% elif 'UDP' in packet.layers %}
                                        bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300
                                    {% elif 'ICMP' in packet.layers %}
                                        bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300
                                    {% else %}
                                        bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300
                                    {% endif %}
                                ">
                                    {% if 'tcp' in packet.layers.frame.protocols %}
                                        TCP
                                    {% elif 'udp' in packet.layers.frame.protocols %}
                                        UDP
                                    {% elif 'icmp' in packet.layers.frame.protocols %}
                                        ICMP
                                    {% else %}
                                        Other
                                    {% endif %}
                                </span>
                                
                                {% if 'HTTP' in packet.layers.frame.protocols %}
                                    <span class="ml-1 px-2 py-1 text-xs font-semibold rounded-full bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300">HTTP</span>
                                {% endif %}
                                
                                {% if 'DNS' in packet.layers.frame.protocols %}
                                    <span class="ml-1 px-2 py-1 text-xs font-semibold rounded-full bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300">DNS</span>
                                {% endif %}
                            </td>
                            <td class="p-4 text-sm text-gray-500 dark:text-gray-400">
                                {{ packet.layers.frame.length }} bytes
                            </td>
                            <td class="p-4 text-sm">
                                <button class="text-primary-600 dark:text-primary-400 hover:text-primary-800 dark:hover:text-primary-300 font-medium packet-details-btn"
                                    data-packet="{{ packet  }}">
                                    <i class="fas fa-eye mr-1"></i> View
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <!-- Empty State -->
            <div id="empty-packets" class="flex flex-col items-center justify-center py-12 px-4 {% if packets %}hidden{% endif %}">
                <div class="bg-gray-100 dark:bg-gray-700 p-6 rounded-full mb-4">
                    <i class="fas fa-exchange-alt text-4xl text-gray-400 dark:text-gray-500"></i>
                </div>
                <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100">No packets found</h3>
                <p class="text-gray-500 dark:text-gray-400 text-center mt-2">There are no packets associated with this flow</p>
            </div>
        </div>
    </div>

    <!-- Packet Details Modal -->
    <div id="packet-details-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
            <div class="flex justify-between items-center p-6 border-b border-gray-200 dark:border-gray-700">
                <h3 class="text-xl font-bold text-gray-800 dark:text-white">Packet Details</h3>
                <button id="close-modal" class="text-gray-400 hover:text-gray-500 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-6 overflow-y-auto" style="max-height: calc(90vh - 120px);">
                <div id="packet-details-content">
                    <!-- Packet Header Information -->
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-3">Packet Header</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Ethernet Frame</h5>
                                <table class="w-full text-sm">
                                    <tbody>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Source MAC:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">00:1A:2B:3C:4D:5E</td>
                                        </tr>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Destination MAC:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">00:5E:4D:3C:2B:1A</td>
                                        </tr>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Type:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">IPv4 (0x0800)</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">IP Header</h5>
                                <table class="w-full text-sm">
                                    <tbody>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Version:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">IPv4</td>
                                        </tr>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Header Length:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">20 bytes</td>
                                        </tr>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">TTL:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">64</td>
                                        </tr>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Protocol:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">TCP (6)</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">TCP Header</h5>
                                <table class="w-full text-sm">
                                    <tbody>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Source Port:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">49152</td>
                                        </tr>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Destination Port:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">80</td>
                                        </tr>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Sequence Number:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">1234567890</td>
                                        </tr>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Flags:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">SYN, ACK</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Application Layer</h5>
                                <table class="w-full text-sm">
                                    <tbody>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Protocol:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">HTTP</td>
                                        </tr>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Method:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">GET</td>
                                        </tr>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Host:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">example.com</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>

    <script>
        // Theme toggle functionality
        const themeToggle = document.getElementById('theme-toggle');
        
        // Check for saved theme preference or use system preference
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
        
        themeToggle.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
        });

        // Packet details modal
        
        const packetDetailsModal = document.getElementById('packet-details-modal');
        const closeModalBtn = document.getElementById('close-modal');
        const packetDetailsBtns = document.querySelectorAll('.packet-details-btn');
        const packetDetailsContent = document.getElementById("packet-details-content");
        
        packetDetailsBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const packet = JSON.parse(btn.dataset.packet.replace(/'/g, '"'));
                console.log(packet)

                packetDetailsContent.innerHTML = `
                    <!-- Packet Header Information -->
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold text-gray-800 dark:text-white mb-3">Packet Header</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Frame</h5>
                                <table class="w-full text-sm">
                                    <tbody>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Frame Number:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">${packet.layers.frame.number || "Not Available"}</td>
                                        </tr>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Length:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">${packet.layers.frame.length || "Not Available"}</td>
                                        </tr>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Protocol:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">${packet.layers.frame.protocols || "Not Available"}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Ethernet Frame</h5>
                                <table class="w-full text-sm">
                                    <tbody>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Source MAC:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">${packet.layers.data_link.src || "Not Available"}</td>
                                        </tr>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Destination MAC:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">${packet.layers.data_link.dst || "Not Available"}</td>
                                        </tr>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Type:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">${packet.layers.data_link.type || "Not Available"}</td>
                                        </tr>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Header Size:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">${packet.layers.data_link.header_size || "Not Available"}</td>
                                        </tr>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Trailer Size:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">${packet.layers.data_link.trailer_size || "Not Available"}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">IP Header</h5>
                                <table class="w-full text-sm">
                                    <tbody>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Version:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">${packet.layers.network.version || "Not Available"}</td>
                                        </tr>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Header Length:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">${packet.layers.network.hdr_len || "Not Available"}</td>
                                        </tr>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">TTL:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">${packet.layers.network.ttl || "Not Available"}</td>
                                        </tr>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Protocol Number:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">${packet.layers.network.proto || "Not Available"}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                                <h5 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Transport Layer</h5>
                                <table class="w-full text-sm">
                                    <tbody>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Source Port:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">${packet.layers.transport.src_port || "Not Available"}</td>
                                        </tr>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Destination Port:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">${packet.layers.transport.dst_port || "Not Available"}</td>
                                        </tr>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Sequence Number:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">${packet.layers.transport.seq || "Not Available"}</td>
                                        </tr>
                                        <tr>
                                            <td class="py-1 text-gray-500 dark:text-gray-400">Flags:</td>
                                            <td class="py-1 text-gray-900 dark:text-gray-200">${packet.layers.transport.flags || "Not Available"}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                        </div>
                    </div>
                
                `

                packetDetailsModal.classList.remove('hidden');
            });
        });
        
        closeModalBtn.addEventListener('click', () => {
            packetDetailsModal.classList.add('hidden');
        });
        
        packetDetailsModal.addEventListener('click', (e) => {
            if (e.target === packetDetailsModal) {
                packetDetailsModal.classList.add('hidden');
            }
        });

        // Packet search functionality
        const packetSearch = document.getElementById('packet-search');
        const packetFilter = document.getElementById('packet-filter');
        const packetRows = document.querySelectorAll('#packets-table-body tr');
        
        packetSearch.addEventListener('input', filterPackets);
        packetFilter.addEventListener('change', filterPackets);
        
        function filterPackets() {
            const searchTerm = packetSearch.value.toLowerCase();
            const filterValue = packetFilter.value;
            
            packetRows.forEach(row => {
                const text = row.textContent.toLowerCase();
                const protocolCell = row.querySelector('td:nth-child(5)');
                const protocol = protocolCell ? protocolCell.textContent.toLowerCase() : '';
                
                const matchesSearch = text.includes(searchTerm);
                let matchesFilter = true;
                
                if (filterValue !== 'all') {
                    matchesFilter = protocol.includes(filterValue);
                }
                
                if (matchesSearch && matchesFilter) {
                    row.classList.remove('hidden');
                } else {
                    row.classList.add('hidden');
                }
            });
            
            // Check if we need to show empty state
            const visibleRows = document.querySelectorAll('#packets-table-body tr:not(.hidden)');
            const emptyState = document.getElementById('empty-packets');
            
            if (visibleRows.length === 0) {
                emptyState.classList.remove('hidden');
            } else {
                emptyState.classList.add('hidden');
            }
        }

        // Export functionality
        // document.getElementById('export-btn').addEventListener('click', function() {
        //     alert('Flow data exported successfully!');
        // });
    </script>
</body>
</html>